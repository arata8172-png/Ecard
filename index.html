<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Eカード</title>

<style>
html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
}

:root {
  --card-width: min(18vw, 90px);
  --result-size: min(7vw, 30px);
}

body {
  background: #0b0b0b;
  color: #fff;
  font-family: sans-serif;
  text-align: center;
}

/* ステータス */
#status {
  font-size: 4vw;
  margin: 2vh 0;
}

/* 手札 */
#hand {
  display: flex;
  justify-content: center;
  gap: 2vw;
  margin-top: 2vh;
}

.card-btn {
  background: none;
  border: none;
  padding: 0;
}

.card-btn img {
  width: var(--card-width);
}

.card-btn.selected img {
  outline: 3px solid #fff;
  border-radius: 8px;
}

/* ボタン */
button.action {
  font-size: 4vw;
  padding: 1.2vh 5vw;
  margin-top: 2vh;
}

#showResultBtn {
  font-size: 26px;
  padding: 20px 40px;
  background: #e53935;
  color: #fff;
}

/* 結果 */
#result {
  margin-top: 2vh;
}

.result-text {
  font-size: var(--result-size);
  font-weight: bold;
  margin-top: 1vh;
}

.win-emperor { color: gold; }
.win-slave { color: crimson; }
.draw { color: #aaa; }

.hidden { display: none; }
</style>
</head>

<body>

<div id="status">カードを選んでください</div>

<button id="confirmBtn" class="action" style="display:none;">
  このカードを出す
</button>

<button id="showResultBtn" class="action" style="display:none;">
  結果を見る
</button>

<div id="hand"></div>

<div id="result" class="hidden"></div>

<button id="nextBtn" class="action hidden">次へ</button>

<script>
/* カード画像 */
const CARD_IMAGES = {
  "皇帝": "emperor3.png",
  "市民": "citizen2.png",
  "奴隷": "slave2.png"
};

let round = 1;
let turn = 1;
let emperorWin = 0;
let slaveWin = 0;

let emperorHand = [];
let slaveHand = [];
let emperorCard = null;
let slaveCard = null;
let selectedCard = null;

/* 手札初期化 */
function setupHands() {
  emperorHand = ["皇帝","市民","市民","市民","市民"];
  slaveHand   = ["奴隷","市民","市民","市民","市民"];
}
setupHands();

function updateStatus() {
  document.getElementById("status").innerText =
    `第${round}戦 ターン${turn}`;
}

function showHand(player) {
  const hand = player === "皇帝" ? emperorHand : slaveHand;
  const div = document.getElementById("hand");
  div.innerHTML = "";

  hand.forEach(card => {
    const btn = document.createElement("button");
    btn.className = "card-btn";

    const img = document.createElement("img");
    img.src = CARD_IMAGES[card];

    btn.appendChild(img);
    btn.onclick = e => selectCard(card, e);

    div.appendChild(btn);
  });
}

function selectCard(card, event) {
  document.querySelectorAll(".card-btn")
    .forEach(btn => btn.classList.remove("selected"));

  event.currentTarget.classList.add("selected");
  selectedCard = card;

  document.getElementById("confirmBtn").style.display = "inline-block";
}

function judge() {
  if (emperorCard === "皇帝" && slaveCard === "市民") return "皇帝側勝利";
  if (emperorCard === "市民" && slaveCard === "奴隷") return "皇帝側勝利";
  if (emperorCard === "皇帝" && slaveCard === "奴隷") return "奴隷側勝利";
  return "引き分け";
}

function reveal() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("showResultBtn").style.display = "none";

  const result = judge();

  if (result === "皇帝側勝利") emperorWin++;
  if (result === "奴隷側勝利") slaveWin++;

  let cls = "draw";
  if (result === "皇帝側勝利") cls = "win-emperor";
  if (result === "奴隷側勝利") cls = "win-slave";

  const r = document.getElementById("result");
  r.classList.remove("hidden");
  r.innerHTML = `
    <div>
      <img src="${CARD_IMAGES[emperorCard]}" width="80">
      <img src="${CARD_IMAGES[slaveCard]}" width="80">
    </div>
    <div class="result-text ${cls}">${result}</div>
  `;

  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextPhase() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("result").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("confirmBtn").style.display = "none";

  selectedCard = null;
  emperorCard = null;
  slaveCard = null;

  updateStatus();
  showHand("皇帝");
}

document.getElementById("confirmBtn").onclick = () => {
  document.getElementById("confirmBtn").style.display = "none";

  if (emperorCard === null) {
    emperorCard = selectedCard;
    selectedCard = null;
    document.getElementById("hand").innerHTML = "";
    document.getElementById("status").innerText = "奴隷側がカードを選んでください";
    showHand("奴隷");
    return;
  }

  if (slaveCard === null) {
    slaveCard = selectedCard;
    selectedCard = null;
    document.getElementById("hand").innerHTML = "";
    document.getElementById("showResultBtn").style.display = "inline-block";
  }
};

document.getElementById("showResultBtn").onclick = reveal;
document.getElementById("nextBtn").onclick = nextPhase;

nextPhase();
</script>
</body>
</html>
