<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Eカード</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: #111;
  color: #fff;
  font-family: sans-serif;
  text-align: center;
}

h2 {
  margin-top: 20px;
}

#hand {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}

.card-btn {
  background: none;
  border: none;
  padding: 0;
}

.card-btn img {
  width: 90px;
}

button.action {
  font-size: 18px;
  padding: 10px 25px;
  margin-top: 20px;
}

.hidden {
  display: none;
}
  /* ===== 結果演出 ===== */
.result-text {
  font-size: 42px;
  font-weight: bold;
  margin-top: 20px;
  letter-spacing: 4px;
  text-shadow:
    0 0 10px rgba(255,255,255,0.6),
    0 0 20px rgba(255,215,0,0.8);
}

/* 勝敗別カラー */
.win-emperor {
  color: gold;
}

.win-slave {
  color: crimson;
}

.draw {
  color: #aaa;
}

/* フェードイン演出 */
@keyframes fadeZoom {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.result-animate {
  animation: fadeZoom 0.6s ease-out;
}
</style>
</head>
<body>

<h2 id="status"></h2>

<div id="hand"></div>

<button id="confirmBtn" class="action hidden">このカードを出す</button>

<div id="result" class="hidden"></div>
<button id="nextBtn" class="action hidden">次へ</button>

<script>
// ===== カード画像定義 =====
const CARD_IMAGES = {
  "皇帝": "src=images/emperor.png",
  "市民": "src=images/citizen.png",
  "奴隷": "src=images/slave.png"
};

// ===== ゲーム状態 =====
let round = 1;
let turn = 1;
let emperorWin = 0;
let slaveWin = 0;

let emperorHand = [];
let slaveHand = [];

let emperorCard = null;
let slaveCard = null;

// ===== 初期化 =====
function setupHands() {
  emperorHand = ["皇帝","市民","市民","市民","市民"];
  slaveHand   = ["奴隷","市民","市民","市民","市民"];
}

setupHands();

// ===== 表示更新 =====
function updateStatus(text) {
  document.getElementById("status").innerText = text;
}

// ===== 手札表示（画像ボタン）=====
function showHand(player) {
  const handDiv = document.getElementById("hand");
  handDiv.innerHTML = "";

  const hand = player === "皇帝" ? emperorHand : slaveHand;

  hand.forEach((card, index) => {
    const btn = document.createElement("button");
    btn.className = "card-btn";

    const img = document.createElement("img");
    img.src = CARD_IMAGES[card];

    btn.appendChild(img);
    btn.onclick = () => selectCard(player, index);

    handDiv.appendChild(btn);
  });
}

// ===== カード選択 =====
function selectCard(player, index) {
  if (player === "皇帝" && !emperorCard) {
    emperorCard = emperorHand.splice(index, 1)[0];
  }
  if (player === "奴隷" && !slaveCard) {
    slaveCard = slaveHand.splice(index, 1)[0];
  }

  document.getElementById("confirmBtn").classList.remove("hidden");
}

// ===== 勝敗判定 =====
function judge() {
  if (emperorCard === "皇帝" && slaveCard === "市民") return "皇帝側勝利";
  if (emperorCard === "市民" && slaveCard === "奴隷") return "皇帝側勝利";
  if (emperorCard === "皇帝" && slaveCard === "奴隷") return "奴隷側勝利";
  return "引き分け";
}

// ===== 公開 =====
function reveal() {
  const result = judge();

  if (result === "皇帝側勝利") emperorWin++;
  if (result === "奴隷側勝利") slaveWin++;

  const r = document.getElementById("result");
  r.classList.remove("hidden");
  r.innerHTML = `
    <div>
      皇帝側<br>
      <img src="${CARD_IMAGES[emperorCard]}" width="120">
    </div>
    <div style="margin-top:10px">
      奴隷側<br>
      <img src="${CARD_IMAGES[slaveCard]}" width="120">
    </div>
    let resultClass = "draw";
if (result === "皇帝側勝利") resultClass = "win-emperor";
if (result === "奴隷側勝利") resultClass = "win-slave";

r.innerHTML = `
  <div>
    皇帝側<br>
    <img src="${CARD_IMAGES[emperorCard]}" width="120">
  </div>

  <div style="margin-top:10px">
    奴隷側<br>
    <img src="${CARD_IMAGES[slaveCard]}" width="120">
  </div>

  <div class="result-text result-animate ${resultClass}">
    ${result}
  </div>
`;

  `;

  document.getElementById("nextBtn").classList.remove("hidden");

  if (result !== "引き分け" || turn === 5) {
    round++;
    turn = 1;
    setupHands();
  } else {
    turn++;
  }

  emperorCard = null;
  slaveCard = null;
}

// ===== 次フェーズ =====
function nextPhase() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("confirmBtn").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  if (round > 12 || emperorWin >= 7 || slaveWin >= 7) {
    updateStatus(`終了！ 皇帝 ${emperorWin}勝 / 奴隷 ${slaveWin}勝`);
    return;
  }

  let first =
    (turn === 1 || turn === 3) ? "皇帝" :
    (turn === 2 || turn === 4) ? "奴隷" : "同時";

  updateStatus(`第${round}戦 ターン${turn}（先出し：${first}側）`);

  showHand(first);
}

// ===== ボタン処理 =====
document.getElementById("confirmBtn").onclick = () => {
  document.getElementById("confirmBtn").classList.add("hidden");

  if (!emperorCard) showHand("皇帝");
  else if (!slaveCard) showHand("奴隷");
  else reveal();
};

document.getElementById("nextBtn").onclick = nextPhase;

// ===== スタート =====
nextPhase();
</script>

</body>
</html>
