<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eカード</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  overflow-x: hidden;
  font-family: sans-serif;
}

:root {
  --card-width: min(18vw, 90px);
  --result-size: min(7vw, 30px);
}

#app {
  text-align: center;
  padding: 1rem;
}

#status {
  font-size: 3.2vw;
  margin-bottom: 1vh;
}

#hand {
  display: flex;
  justify-content: center;
  gap: 2vw;
  margin-top: 2vh;
}

.card-btn {
  border: none;
  background: none;
}

.card-btn img {
  width: var(--card-width);
}

button.action {
  font-size: 3.2vw;
  padding: 0.8vh 4vw;
  margin-top: 2vh;
}

#result {
  margin-top: 2vh;
}

.result-text {
  font-size: var(--result-size);
  font-weight: 900;
  letter-spacing: 0.15em;
}
</style>
</head>

<body>
<div id="app">

  <div id="status">カードを選んでください</div>

  <!-- ★ 結果を見るボタン（ここが追加点） -->
  <button id="showResultBtn" class="action" style="display:none;">
    結果を見る
  </button>

  <div id="hand"></div>

  <div id="result"></div>

</div>

<script>
/* ===== 変数 ===== */
let emperorChoice = null;
let slaveChoice = null;
let pendingResult = null;
let isEmperorTurn = true;

/* 仮画像 */
const CARD_IMAGES = {
  emperor: src="emperor.png",
  citizen: src="citizen.png",
  slave: src="slave.png"
};

/* ===== 初期表示 ===== */
renderHand(["emperor", "citizen", "citizen", "citizen", "citizen"]);

/* ===== 関数 ===== */

function renderHand(cards) {
  const hand = document.getElementById("hand");
  hand.innerHTML = "";
  cards.forEach(card => {
    const btn = document.createElement("button");
    btn.className = "card-btn";
    btn.onclick = () => selectCard(card);
    btn.innerHTML = `<img src="${CARD_IMAGES[card]}">`;
    hand.appendChild(btn);
  });
}

function selectCard(card) {
  if (isEmperorTurn) {
    emperorChoice = card;
    isEmperorTurn = false;
    document.getElementById("status").innerText = "後手がカードを選んでください";
    document.getElementById("hand").innerHTML = "";
    renderHand(["slave", "citizen", "citizen", "citizen", "citizen"]);
  } else {
    slaveChoice = card;

    // ★ ここでは結果を出さない
    pendingResult = {
      emperor: emperorChoice,
      slave: slaveChoice
    };

    showResultButton();
  }
}

function showResultButton() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("status").innerText = "結果を確認してください";
  document.getElementById("showResultBtn").style.display = "inline-block";
}

document.getElementById("showResultBtn").onclick = () => {
  document.getElementById("showResultBtn").style.display = "none";
  reveal(pendingResult.emperor, pendingResult.slave);
  pendingResult = null;
};

function reveal(emperor, slave) {
  const resultDiv = document.getElementById("result");

  let resultText = "引き分け";
  if (emperor === "emperor" && slave === "slave") resultText = "奴隷の勝ち";
  if (emperor === "emperor" && slave === "citizen") resultText = "皇帝の勝ち";
  if (emperor === "citizen" && slave === "slave") resultText = "市民の勝ち";

  resultDiv.innerHTML = `
    <div style="display:flex; justify-content:center; gap:3vw;">
      <img src="${CARD_IMAGES[emperor]}" style="width:14vw">
      <img src="${CARD_IMAGES[slave]}" style="width:14vw">
    </div>
    <div class="result-text">${resultText}</div>
  `;

  document.getElementById("status").innerText = "結果";
}
</script>
</body>
</html>
