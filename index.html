<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Eカード</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #0b0b0b;
  color: #fff;
  font-family: "Hiragino Kaku Gothic ProN", sans-serif;
  text-align: center;
  overflow-x: hidden;
}

#hand {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
}

.card-btn {
  background: none;
  border: none;
}

.card-btn img {
  width: 90px;
}

button.action {
  font-size: 18px;
  padding: 10px 28px;
  margin-top: 20px;
}

.hidden {
  display: none;
}

/* ===== 結果演出 ===== */
.result-text {
  font-size: 48px;
  font-weight: 900;
  letter-spacing: 6px;
  margin-top: 25px;
}

/* 皇帝勝利 */
.win-emperor {
  color: gold;
  text-shadow:
    0 0 15px gold,
    0 0 40px orange;
  animation: emperorGlow 0.8s ease-out;
}

/* 奴隷勝利 */
.win-slave {
  color: crimson;
  text-shadow:
    0 0 20px crimson,
    0 0 40px darkred;
  animation: slaveImpact 0.6s ease-out;
}

/* 引き分け */
.draw {
  color: #aaa;
  animation: fadeIn 0.5s ease-out;
}

/* ===== アニメーション ===== */
@keyframes emperorGlow {
  from { opacity: 0; transform: scale(0.7); }
  to   { opacity: 1; transform: scale(1); }
}

@keyframes slaveImpact {
  0%   { transform: scale(0.6) translateX(0); }
  30%  { transform: scale(1.1) translateX(-8px); }
  60%  { transform: scale(1.05) translateX(8px); }
  100% { transform: scale(1); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
</style>
</head>

<body>

<h2 id="status"></h2>

<div id="hand"></div>

<button id="confirmBtn" class="action hidden">このカードを出す</button>

<div id="result" class="hidden"></div>
<button id="nextBtn" class="action hidden">次へ</button>

<script>
// ===== カード画像 =====
const CARD_IMAGES = {
  "皇帝": src="emperor.png",
  "市民": src="citizen.png",
  "奴隷": src="slave.png"
};

// ===== 状態 =====
let round = 1;
let turn = 1;
let emperorWin = 0;
let slaveWin = 0;

let emperorHand = [];
let slaveHand = [];

let emperorCard = null;
let slaveCard = null;

// ===== 初期化 =====
function setupHands() {
  emperorHand = ["皇帝","市民","市民","市民","市民"];
  slaveHand   = ["奴隷","市民","市民","市民","市民"];
}
setupHands();

function updateStatus(text) {
  document.getElementById("status").innerText = text;
}

// ===== 手札表示 =====
function showHand(player) {
  const hand = player === "皇帝" ? emperorHand : slaveHand;
  const handDiv = document.getElementById("hand");
  handDiv.innerHTML = "";

  hand.forEach((card, index) => {
    const btn = document.createElement("button");
    btn.className = "card-btn";

    const img = document.createElement("img");
    img.src = CARD_IMAGES[card];

    btn.appendChild(img);
    btn.onclick = () => selectCard(player, index);

    handDiv.appendChild(btn);
  });
}

// ===== 選択 =====
function selectCard(player, index) {
  if (player === "皇帝" && !emperorCard) {
    emperorCard = emperorHand.splice(index, 1)[0];
  }
  if (player === "奴隷" && !slaveCard) {
    slaveCard = slaveHand.splice(index, 1)[0];
  }
  document.getElementById("confirmBtn").classList.remove("hidden");
}

// ===== 判定 =====
function judge() {
  if (emperorCard === "皇帝" && slaveCard === "市民") return "皇帝側勝利";
  if (emperorCard === "市民" && slaveCard === "奴隷") return "皇帝側勝利";
  if (emperorCard === "皇帝" && slaveCard === "奴隷") return "奴隷側勝利";
  return "引き分け";
}

// ===== 公開 =====
function reveal() {
  const result = judge();

  if (result === "皇帝側勝利") emperorWin++;
  if (result === "奴隷側勝利") slaveWin++;

  let resultClass = "draw";
  if (result === "皇帝側勝利") resultClass = "win-emperor";
  if (result === "奴隷側勝利") resultClass = "win-slave";

  const r = document.getElementById("result");
  r.classList.remove("hidden");
  r.innerHTML = `
    <div>
      <img src="${CARD_IMAGES[emperorCard]}" width="120">
      <img src="${CARD_IMAGES[slaveCard]}" width="120">
    </div>
    <div class="result-text ${resultClass}">
      ${result}
    </div>
  `;

  document.getElementById("nextBtn").classList.remove("hidden");

  if (result !== "引き分け" || turn === 5) {
    round++;
    turn = 1;
    setupHands();
  } else {
    turn++;
  }

  emperorCard = null;
  slaveCard = null;
}

// ===== 次へ =====
function nextPhase() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("confirmBtn").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  if (round > 12 || emperorWin >= 7 || slaveWin >= 7) {
    updateStatus(`終了！ 皇帝 ${emperorWin}勝 / 奴隷 ${slaveWin}勝`);
    return;
  }

  let first =
    (turn === 1 || turn === 3) ? "皇帝" :
    (turn === 2 || turn === 4) ? "奴隷" : "同時";

  updateStatus(`第${round}戦 ターン${turn}（先出し：${first}）`);
  showHand(first);
}

document.getElementById("confirmBtn").onclick = () => {
  document.getElementById("confirmBtn").classList.add("hidden");
  if (!emperorCard) showHand("皇帝");
  else if (!slaveCard) showHand("奴隷");
  else reveal();
};

document.getElementById("nextBtn").onclick = nextPhase;

// ===== スタート =====
nextPhase();
</script>

</body>
</html>
