<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Eカード</title>

<style>
  html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}
:root {
--card-width: calc((100vw - 16vw) / 5);
}

body {
  margin: 0;
  padding: 0;
  background: #0b0b0b;
  color: #fff;
  font-family: sans-serif;
  text-align: center;
}

/* ===== 上部ステータス ===== */
#status {
  font-size: 4vw;
  margin: 2vh 0;
}

/* ===== 手札 ===== */
#hand {
  display: flex;
  justify-content: center;
  gap: 1vw;
  margin-top: 4vh;
  max-width: 100vw;
  overflow-x: hidden;
}
  
/* 選択中カード */
.card-btn.selected img {
  box-sizing: border-box;
  border: 4px solid white;
  border-radius: 10px;
  box-shadow: 0 0 12px rgba(255,255,255,0.8);
  transform: scale(1.04);
}

  .card-btn.selected img {
  transform: scale(1.08);
}

  .card-btn img {
  transition: transform 0.15s, box-shadow 0.15s;
}

.card-btn {
  background: none;
  border: none;
  padding: 4px;
  flex: 0 0 auto; 
}

.card-btn img {
  width: var(--card-width);
  max-width: 90px;
  height: auto;
}

/* ===== ボタン ===== */
button.action {
  font-size: 4vw;
  padding: 1.2vh 5vw;
  margin-top: 2vh;
}

#revealBtn {
  font-size: 26px;
  padding: 20px 40px;
  margin-top: 20px;
  background: #e53935;
  color: #fff;
}

/* ===== 結果表示 ===== */
#result {
  margin-top: 2vh;
}

.result-text {
  font-size: var(--result-size);
  font-weight: 900;
  letter-spacing: 0.25em;
  margin-top: 1vh;
}

/* 皇帝勝利 */
.win-emperor {
  color: gold;
  text-shadow:
    0 0 1.5vh gold,
    0 0 3vh orange;
  animation: emperorGlow 0.7s ease-out;
}

/* 奴隷勝利 */
.win-slave {
  color: crimson;
  text-shadow:
    0 0 2vh crimson,
    0 0 4vh darkred;
  animation: slaveImpact 0.6s ease-out;
}

/* 引き分け */
.draw {
  color: #aaa;
  animation: fadeIn 0.4s ease-out;
}

.hidden {
  display: none;
}

/* ===== アニメ ===== */
@keyframes emperorGlow {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

@keyframes slaveImpact {
  0%   { transform: scale(0.7) translateX(0); }
  30%  { transform: scale(1.1) translateX(-3vw); }
  60%  { transform: scale(1.05) translateX(3vw); }
  100% { transform: scale(1); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>
</head>

<body>

<div id="status"></div>

<div id="hand"></div>

<button id="confirmBtn" class="action hidden">このカードを出す</button>
  
<button id="revealBtn" class="hidden">結果を見る</button>

<div id="result" class="hidden"></div>
  
<button id="nextBtn" class="action hidden">次へ</button>

<script>
const CITIZEN_IMAGES = [
  src="citizen2.png",
  src="citizen3.png",
  src="citizen4.png",
  src="citizen5.png"
];
const CARD_IMAGES = {
  "皇帝": src="emperor3.png",
  "奴隷": src="slave2.png"
};
  
function makeCitizenCard() {
return {
  type: "市民",
  img: CITIZEN_IMAGES[Math.floor(Math.random() * CITIZEN_IMAGES.length)]
};
}

let round = 1;
let turn = 1;
let emperorWin = 0;
let slaveWin = 0;

let emperorHand = [];
let slaveHand = [];
let emperorCard = null;
let slaveCard = null;
  
let pendingResult = null;

function setupHands() {
  emperorHand = [
    { type: "皇帝", img: CARD_IMAGES["皇帝"] },
    makeCitizenCard(),
    makeCitizenCard(),
    makeCitizenCard(),
    makeCitizenCard()
  ];

  slaveHand = [
    { type: "奴隷", img: CARD_IMAGES["奴隷"] },
    makeCitizenCard(),
    makeCitizenCard(),
    makeCitizenCard(),
    makeCitizenCard()
  ];
}
setupHands();

function updateStatus() {
  document.getElementById("status").innerText =
    `第${round}戦 ターン${turn}`;
}

function showHand(player) {
  const hand = player === "皇帝" ? emperorHand : slaveHand;
  const div = document.getElementById("hand");
  div.innerHTML = "";

  hand.forEach((card, i) => {
    const btn = document.createElement("button");
    btn.className = "card-btn";
    btn.dataset.index = i;

    const img = document.createElement("img");
    img.src = CARD_IMAGES[card];

    btn.appendChild(img);

    btn.onclick = () => {
      // ★ 既存の選択枠を消す
      document.querySelectorAll(".card-btn").forEach(b => {
        b.classList.remove("selected");
      });

      // ★ このカードを選択状態に
      btn.classList.add("selected");

      selectCard(player, i);
    };

    div.appendChild(btn);
  });
}


function selectCard(player, index) {
  if (player === "皇帝" && !emperorCard) {
    emperorCard = emperorHand.splice(index, 1)[0];
  }
  if (player === "奴隷" && !slaveCard) {
    slaveCard = slaveHand.splice(index, 1)[0];
  }
  document.getElementById("confirmBtn").classList.remove("hidden");
}

function judge() {
  if (emperorCard === "皇帝" && slaveCard === "市民") return "皇帝側勝利";
  if (emperorCard === "市民" && slaveCard === "奴隷") return "皇帝側勝利";
  if (emperorCard === "皇帝" && slaveCard === "奴隷") return "奴隷側勝利";
  return "引き分け";
}

function reveal() {
  // ★ 手札を消す
  document.getElementById("hand").innerHTML = "";

  const result = judge();

  if (result === "皇帝側勝利") emperorWin++;
  if (result === "奴隷側勝利") slaveWin++;

  let cls = "draw";
  if (result === "皇帝側勝利") cls = "win-emperor";
  if (result === "奴隷側勝利") cls = "win-slave";

  const r = document.getElementById("result");
  r.classList.remove("hidden");
  r.innerHTML = `
    <div>
      <img src="${CARD_IMAGES[emperorCard]}" style="width:20vw">
      <img src="${CARD_IMAGES[slaveCard]}" style="width:20vw">
    </div>
    <div class="result-text ${cls}">
      ${result}
    </div>
  `;

  document.getElementById("nextBtn").classList.remove("hidden");

  if (result !== "引き分け" || turn === 5) {
    round++;
    turn = 1;
    setupHands();
  } else {
    turn++;
  }

  emperorCard = null;
  slaveCard = null;
}

function nextPhase() {
  document.getElementById("hand").innerHTML = "";
  document.getElementById("confirmBtn").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  if (round > 12 || emperorWin >= 7 || slaveWin >= 7) {
    document.getElementById("status").innerText =
      `終了 皇帝${emperorWin}勝 / 奴隷${slaveWin}勝`;
    return;
  }

  updateStatus();

  let first =
    (turn === 1 || turn === 3) ? "皇帝" :
    (turn === 2 || turn === 4) ? "奴隷" : "皇帝";

  showHand(first);
}

document.getElementById("confirmBtn").onclick = () => {
  document.getElementById("confirmBtn").classList.add("hidden");

  if (!emperorCard) {
    showHand("皇帝");
  } else if (!slaveCard) {
    showHand("奴隷");
  } else {
    // 両者出し終わったら「結果を見る」ボタン表示
    document.getElementById("hand").innerHTML = "";
    document.getElementById("revealBtn").classList.remove("hidden");
    document.getElementById("revealBtn").onclick = () => {
  document.getElementById("revealBtn").classList.add("hidden");
  reveal();
    }
  }
};
  


document.getElementById("nextBtn").onclick = nextPhase;

nextPhase();
</script>

</body>
</html>
