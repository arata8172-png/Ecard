<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Eカード</title>

<style>
* { box-sizing: border-box; }

html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}

:root {
  --card-width: min(18vw, 90px);
  --result-size: min(7vw, 30px);
}

body {
  margin: 0;
  background: #0b0b0b;
  color: #fff;
  font-family: sans-serif;
  text-align: center;
}

/* ===== 上部ステータス ===== */
#status {
  font-size: 4vw;
  margin: 2vh 0;
}

/* ===== 手札 ===== */
#hand {
  display: flex;
  justify-content: center;
  gap: 2vw;
  margin-top: 2vh;
}

.card-btn {
  background: none;
  border: none;
  padding: 0;
}

.card-btn img {
  width: var(--card-width);
}

/* ===== ボタン ===== */
button.action {
  font-size: 3.5vw;
  padding: 1vh 4vw;
  margin-top: 2vh;
}

/* ===== 結果 ===== */
#result {
  margin-top: 2vh;
}

.result-text {
  font-size: var(--result-size);
  font-weight: 900;
  letter-spacing: 0.15em;
  margin-top: 1vh;
}

/* 勝敗演出 */
.win-emperor {
  color: gold;
  text-shadow: 0 0 2vh gold;
  animation: pop 0.3s ease-out;
}

.win-slave {
  color: crimson;
  text-shadow: 0 0 2vh crimson;
  animation: pop 0.3s ease-out;
}

.draw {
  color: #aaa;
  animation: fadeIn 0.4s ease-out;
}

.hidden { display: none; }

@keyframes pop {
  from { transform: scale(0.7); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ===== 暗転 ===== */
.dark-overlay {
  position: fixed;
  inset: 0;
  background: black;
  opacity: 0;
  pointer-events: none;
  z-index: 9999;
  transition: opacity 0.25s ease;
}

.dark-overlay.active {
  opacity: 1;
}
</style>
</head>

<body>

<div id="status"></div>
<div id="hand"></div>

<button id="confirmBtn" class="action hidden">このカードを出す</button>
<button id="showResultBtn" class="action hidden">結果を見る</button>

<div id="result" class="hidden"></div>
<button id="nextBtn" class="action hidden">次へ</button>

<div id="darkOverlay" class="dark-overlay"></div>

<script>
const CARD_IMAGES = {
  "皇帝": src="emperor.png",
  "市民": src="citizen.png",
  "奴隷": src="slave.png"
};

let round = 1;
let turn = 1;
let emperorWin = 0;
let slaveWin = 0;

let emperorHand = [];
let slaveHand = [];
let emperorCard = null;
let slaveCard = null;
let pendingResult = null;

function setupHands() {
  emperorHand = ["皇帝","市民","市民","市民","市民"];
  slaveHand   = ["奴隷","市民","市民","市民","市民"];
}

function updateStatus() {
  status.innerText = `第${round}戦 ターン${turn}`;
}

function showHand(player) {
  const hand = player === "皇帝" ? emperorHand : slaveHand;
  handDiv.innerHTML = "";

  hand.forEach((card, i) => {
    const btn = document.createElement("button");
    btn.className = "card-btn";
    btn.innerHTML = `<img src="${CARD_IMAGES[card]}">`;
    btn.onclick = () => selectCard(player, i);
    handDiv.appendChild(btn);
  });
}

function selectCard(player, index) {
  if (player === "皇帝" && !emperorCard)
    emperorCard = emperorHand.splice(index, 1)[0];
  if (player === "奴隷" && !slaveCard)
    slaveCard = slaveHand.splice(index, 1)[0];

  confirmBtn.classList.remove("hidden");
}

function judge() {
  if (emperorCard === "皇帝" && slaveCard === "市民") return "皇帝側勝利";
  if (emperorCard === "市民" && slaveCard === "奴隷") return "皇帝側勝利";
  if (emperorCard === "皇帝" && slaveCard === "奴隷") return "奴隷側勝利";
  return "引き分け";
}

/* ===== 結果を保存するだけ ===== */
function reveal() {
  handDiv.innerHTML = "";

  const result = judge();
  pendingResult = result;

  if (result === "皇帝側勝利") emperorWin++;
  if (result === "奴隷側勝利") slaveWin++;

  showResultBtn.classList.remove("hidden");
}

/* ===== 暗転 → 結果表示 ===== */
showResultBtn.onclick = () => {
  darkOverlay.classList.add("active");

  setTimeout(() => {
    showResult(pendingResult);
    darkOverlay.classList.remove("active");
    showResultBtn.classList.add("hidden");
    pendingResult = null;
  }, 300);
};

function showResult(result) {
  let cls = "draw";
  if (result === "皇帝側勝利") cls = "win-emperor";
  if (result === "奴隷側勝利") cls = "win-slave";

  resultDiv.classList.remove("hidden");
  resultDiv.innerHTML = `
    <div style="margin-bottom:1vh">
      <img src="${CARD_IMAGES[emperorCard]}" style="width:14vw">
      <img src="${CARD_IMAGES[slaveCard]}" style="width:14vw">
    </div>
    <div class="result-text ${cls}">${result}</div>
  `;

  nextBtn.classList.remove("hidden");

  emperorCard = null;
  slaveCard = null;
}

function nextPhase() {
  confirmBtn.classList.add("hidden");
  resultDiv.classList.add("hidden");
  nextBtn.classList.add("hidden");

  if (round > 12 || emperorWin >= 7 || slaveWin >= 7) {
    status.innerText = `終了 皇帝${emperorWin}勝 / 奴隷${slaveWin}勝`;
    return;
  }

  updateStatus();
  showHand(turn % 2 ? "皇帝" : "奴隷");
  turn++;
}

const status = document.getElementById("status");
const handDiv = document.getElementById("hand");
const confirmBtn = document.getElementById("confirmBtn");
const showResultBtn = document.getElementById("showResultBtn");
const resultDiv = document.getElementById("result");
const nextBtn = document.getElementById("nextBtn");
const darkOverlay = document.getElementById("darkOverlay");

confirmBtn.onclick = () => {
  confirmBtn.classList.add("hidden");
  if (!emperorCard) showHand("皇帝");
  else if (!slaveCard) showHand("奴隷");
  else reveal();
};

nextBtn.onclick = nextPhase;

setupHands();
nextPhase();
</script>

</body>
</html>

